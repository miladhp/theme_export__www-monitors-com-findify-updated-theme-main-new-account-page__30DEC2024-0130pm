{%- capture section_settings -%}
{
  "showShippingEstimator": {% if cart.item_count == 0 %}false{% else %}{{ section.settings.show_shipping_estimator | json }}{% endif %}
}
{%- endcapture -%}

<section class="site-i-cart" data-section-id="{{ section.id }}" data-section-type="cart" data-section-settings='{{ section_settings }}' data-item-count="{{ cart.item_count }}">
  <div class="cart-main-wrapper">
    {%- if cart.item_count == 0 -%}
      <div class="container">
        <div class="empty-state">
          <div class="empty-state__icon">
            {%- render 'icon', icon: 'big-cart' -%}
          </div>

          <p class="empty-state__heading heading h1">{{ 'cart.general.empty' | t }}</p>

          {%- if settings.cart_show_free_shipping_threshold -%}
            {%- assign threshold_in_cents = settings.cart_free_shipping_threshold | times: 100 -%}
            {%- capture remaining_amount -%}<span>{{ cart.total_price | minus: threshold_in_cents | abs | money }}</span>{%- endcapture -%}
            <p class="empty-state__description">{{ 'cart.general.free_shipping_remaining_html' | t: remaining_amount: remaining_amount }}</p>
          {%- endif -%}

          <div class="empty-state__button-container">
            <a href="{{ settings.cart_empty_button_link | default: routes.root_url }}" class="empty-state__button button button--primary">{{ 'cart.general.empty_button' | t }}</a>
          </div>
        </div>
      </div>
    {%- else -%}
      <div class="container">
        <header class="page__header page__header--stack">
          <h1 class="page__title heading h1 cart_page_title">{{ 'cart.general.title' | t }}</h1>

          {%- if settings.cart_show_free_shipping_threshold -%}
            {%- assign threshold_in_cents = settings.cart_free_shipping_threshold | times: 100 -%}

            {%- if cart.total_price >= threshold_in_cents -%}
              <p class="page__description">{{ 'cart.general.free_shipping' | t }}</p>
            {%- else -%}
              {%- capture remaining_amount -%}<span>{{ cart.total_price | minus: threshold_in_cents | abs | money }}</span>{%- endcapture -%}
              <p class="page__description">{{ 'cart.general.free_shipping_remaining_html' | t: remaining_amount: remaining_amount }}</p>
            {%- endif -%}
          {%- endif -%}
        </header>
      </div>

      <div class="cart-wrapper">
        <div class="cart-wrapper__inner">
          <div class="cart-wrapper__inner-inner">
            <div class="container container--flush">
              <div class="card_row">
                {%- comment -%}
                --------------------------------------------------------------------------------------
                LINE ITEMS
                --------------------------------------------------------------------------------------
                {%- endcomment -%}

                <div class="card product_card_details">
                  <div class="table-wrapper">
                    <table class="line-item-table table table--loose">
                      <thead class="hidden-phone">
                        <tr>
                          <th>{{ 'customer.order.product' | t }}</th>
                          <th class="table__cell--center">{{ 'customer.order.quantity' | t }}</th>
                          <th class="table__cell--right">Price</th>
                        </tr>
                      </thead>

                      <tbody>
                        {%- assign gift_wrap_product = section.settings.gift_wrap_product -%}

                        {%- for line_item in cart.items -%}
                          <tr class="line-item line-item--stack" data-pro-id="{{ line_item.product_id }}" data-var-id="{{ line_item.variant_id }}">
                            <td class="line-item__product-info">
                              <div class="line-item__product-info-wrapper">
                                <div class="line-item__image-wrapper">
                                  {%- comment -%}For vertical images we force to contain them on a square ratio to avoid growing too large{%- endcomment -%}
                                  <div class="custom-img-div">
                                    {%- if line_item.image.aspect_ratio < 1 -%}
                                      <div class="aspect-ratio aspect-ratio--square custom-aspect-ratio-cart">
                                        <img loading="lazy" src="{{ line_item.image | img_url: '500x' }}" alt="{{ line_item.image.alt | escape }}">
                                      </div>
                                    {%- else -%}
                                      <div class="aspect-ratio custom-aspect-ratio-cart" style="padding-bottom: {{ 100.0 | divided_by: line_item.image.aspect_ratio }}%">
                                        <img loading="lazy" src="{{ line_item.image | img_url: '500x' }}" alt="{{ line_item.image.alt | escape }}">
                                      </div>
                                    {%- endif -%}
                                  </div>

                                  <div class="line-item__quantity hidden-tablet-and-up">
                                      {%- comment -%}If the product has the tag "__gift", we remove the price{%- endcomment -%}
  
                                      {%- unless line_item.product.tags contains '__gift' -%}
                                        <div class="quantity-selector">
                                          {%- assign allow_to_add_more = true -%}
  
                                          {%- if line_item.variant.inventory_management and line_item.variant.inventory_policy == 'deny' and line_item.quantity == line_item.variant.inventory_quantity -%}
                                            {%- assign allow_to_add_more = false -%}
                                          {%- endif -%}
  
                                          <button type="button" class="quantity-selector__button" data-action="decrease-quantity" data-href="{{ routes.cart_change_url }}?quantity={{ line_item.quantity | minus: 1 }}&line={{ forloop.index }}" data-quantity="{{ line_item.quantity | minus: 1 }}" data-line="{{ forloop.index }}" aria-label="{{ 'cart.items.decrease_quantity' | t }}" title="{{ 'cart.items.decrease_quantity' | t }}">{% render 'icon', icon: 'minus' %}</button>
                                          <input aria-label="{{ 'product.form.quantity' | t }}" class="quantity-selector__value" inputmode="numeric" data-current-value="{{ line_item.quantity }}" data-line="{{ forloop.index }}" value="{{ line_item.quantity }}" size="{{ line_item.quantity | append: '' | size | at_least: 2 }}">
                                          <button type="button" class="quantity-selector__button" data-action="increase-quantity" data-href="{{ routes.cart_change_url }}?quantity={{ line_item.quantity | plus: 1 }}&line={{ forloop.index }}" data-quantity="{{ line_item.quantity | plus: 1 }}" data-line="{{ forloop.index }}" {% if allow_to_add_more %}aria-label="{{ 'cart.items.increase_quantity' | t }}" title="{{ 'cart.items.increase_quantity' | t }}"{% else %}disabled="disabled" aria-label="{{ 'cart.items.no_more_stock' | t }}" data-tooltip="{{ 'cart.items.no_more_stock' | t }}" data-tooltip-position="bottom-left"{% endif %}>{% render 'icon', icon: 'plus' %}</button>
                                        </div>
                                      {%- else -%}
                                        <span>{{ line_item.quantity }}</span>
                                      {% endunless -%}
  
                                    {% comment %}  <a href="{{ routes.cart_change_url }}?quantity=0&line={{ forloop.index }}" data-action="decrease-quantity" data-quantity="0" data-line="{{ forloop.index }}" class="line-item__quantity-remove link">
                                        <svg viewBox="-40 0 427 427.00131" xmlns="http://www.w3.org/2000/svg">
                                          <path d="m232.398438 154.703125c-5.523438 0-10 4.476563-10 10v189c0 5.519531 4.476562 10 10 10 5.523437 0 10-4.480469 10-10v-189c0-5.523437-4.476563-10-10-10zm0 0" fill="#949495"/>
                                          <path d="m114.398438 154.703125c-5.523438 0-10 4.476563-10 10v189c0 5.519531 4.476562 10 10 10 5.523437 0 10-4.480469 10-10v-189c0-5.523437-4.476563-10-10-10zm0 0" fill="#949495"/>
                                          <path d="m28.398438 127.121094v246.378906c0 14.5625 5.339843 28.238281 14.667968 38.050781 9.285156 9.839844 22.207032 15.425781 35.730469 15.449219h189.203125c13.527344-.023438 26.449219-5.609375 35.730469-15.449219 9.328125-9.8125 14.667969-23.488281 14.667969-38.050781v-246.378906c18.542968-4.921875 30.558593-22.835938 28.078124-41.863282-2.484374-19.023437-18.691406-33.253906-37.878906-33.257812h-51.199218v-12.5c.058593-10.511719-4.097657-20.605469-11.539063-28.03125-7.441406-7.421875-17.550781-11.5546875-28.0625-11.46875h-88.796875c-10.511719-.0859375-20.621094 4.046875-28.0625 11.46875-7.441406 7.425781-11.597656 17.519531-11.539062 28.03125v12.5h-51.199219c-19.1875.003906-35.394531 14.234375-37.878907 33.257812-2.480468 19.027344 9.535157 36.941407 28.078126 41.863282zm239.601562 279.878906h-189.203125c-17.097656 0-30.398437-14.6875-30.398437-33.5v-245.5h250v245.5c0 18.8125-13.300782 33.5-30.398438 33.5zm-158.601562-367.5c-.066407-5.207031 1.980468-10.21875 5.675781-13.894531 3.691406-3.675781 8.714843-5.695313 13.925781-5.605469h88.796875c5.210937-.089844 10.234375 1.929688 13.925781 5.605469 3.695313 3.671875 5.742188 8.6875 5.675782 13.894531v12.5h-128zm-71.199219 32.5h270.398437c9.941406 0 18 8.058594 18 18s-8.058594 18-18 18h-270.398437c-9.941407 0-18-8.058594-18-18s8.058593-18 18-18zm0 0" fill="#949495"/>
                                          <path d="m173.398438 154.703125c-5.523438 0-10 4.476563-10 10v189c0 5.519531 4.476562 10 10 10 5.523437 0 10-4.480469 10-10v-189c0-5.523437-4.476563-10-10-10zm0 0" fill="#949495"/>
                                        </svg>
                                      </a> {% endcomment %}
                                    </div> 
                                    <a href="{{ routes.cart_change_url }}?quantity=0&line={{ forloop.index }}" data-action="decrease-quantity" data-quantity="0" data-line="{{ forloop.index }}" class="line-item__quantity-remove link cart_custom_remove hidden-tablet-and-up">
                                     Remove
                                   </a>   
                                </div>

                                <div class="line-item__meta">
                                  {%- if settings.show_vendor and gift_wrap_product.handle != line_item.product.handle -%}
                                    {%- assign vendor_handle = line_item.product.vendor | handle -%}
                                    {%- assign collection_for_vendor = collections[vendor_handle] -%}

                                    {%- unless collection_for_vendor.empty? -%}
                                      <a class="line-item__vendor link" href="{{ collection_for_vendor.url }}" style="display:none;">{{ line_item.product.vendor }}</a>
                                      {%- else -%}
                                      <a class="line-item__vendor link" href="{{ line_item.product.vendor | url_for_vendor }}" style="display:none;">{{ line_item.product.vendor }}</a>
                                    {%- endunless -%}
                                  {%- endif -%}

                                  {%- if gift_wrap_product.handle == line_item.product.handle -%}
                                    <span class="line-item__title text--strong" data-var-title="{{ line_item.variant.title }}">{{ line_item.title }}</span>
                                  {%- else -%}
                                    <a href="{{ line_item.url }}" class="line-item__title link text--strong custom_cart_product_title" data-var-title="{{ line_item.variant.title }}">{{ line_item.product.title }}</a>
                                    <div class="custom_cart_div">
                                      <span class="cart_img_span"><img src="https://cdn.shopify.com/s/files/1/2372/2681/files/cart_free_delivery.png?v=1706177573" width="27px" height="14px"> <span class="cart_custom_text">FREE Shipping</span></span>
                                     {% if line_item.variant.option1 != blank  %} <span class="cart_custom_heading">Condition: <span class="cart_custom_text">{{ line_item.variant.option1 }}</span></span> {% endif %}
                                      {% if line_item.variant.option2 != blank or line_item.variant.option3 != blank %} <span class="cart_custom_heading">Option: <span class="cart_custom_text">{{ line_item.variant.option2 }} {{ line_item.variant.option3 }}</span></span>{% endif %}
                                      <span class="cart_custom_heading">Availability: <span class="cart_custom_text">
                                        {%- if line_item.inventory_quantity <= 3 -%}
                                          <span class="product-form__inventory inventory inventory--low cart_inventory_low">Low stock</span>
                                        {%- else -%}
                                          <span class="product-form__inventory inventory inventory--high cart_inventory_high">{{ 'product.form.in_stock' | t }}</span>
                                        {%- endif -%}
                                      </span></span>
                                      {% if line_item.variant.metafields.custom.Configuration != blank  %}
                                        <span class="cart_custom_heading line-item-property__field">Configuration: <span class="cart_custom_text">{{ line_item.variant.metafields.custom.Configuration }}</span><input type="hidden" id="Configuration" name="properties[Configuration]" value="{{ line_item.variant.metafields.custom.Configuration }}"></span>
                                      {% endif %}
                                    </div>
                                  {%- endif -%}

                                  {%- if line_item.selling_plan_allocation -%}
                                    <p class="line-item__plan-allocation">{{ line_item.selling_plan_allocation.selling_plan.name }}</p>
                                  {%- endif -%}

                                  {%- unless line_item.properties == blank -%}
                                    <ul class="line-item__property-list" role="list">
                                      {%- for property in line_item.properties -%}
                                        {%- assign first_character_in_key = property.first | truncate: 1, '' -%}

                                        {%- if property.last == blank or first_character_in_key == '_' -%}
                                          {%- continue -%}
                                        {%- endif -%}

                                        <li class="line-item__property">{{ property.first }}: {{ property.last }}</li>
                                      {%- endfor -%}
                                    </ul>
                                  {%- endunless -%}

                                  <div class="line-item__price-list" style="display:none;">
                                    {%- if line_item.original_price > line_item.final_price -%}
                                      <span class="line-item__price line-item__price--compare"><span class="bcpo-cart-item-original-price" data-key="{{line_item.key}}"><span class="bcpo-cart-item-original-price" data-key="{{line_item.key}}">{{ line_item.original_price | money }}</span></span></span>

                                      {%- if line_item.final_price == 0 -%}
                                        <span class="line-item__price line-item__price--highlight">{{- 'cart.general.free' | t -}}</span>
                                      {%- else -%}
                                        <span class="line-item__price line-item__price--highlight" data-price='<span class="bcpo-cart-item-price" data-key="{{line_item.key}}"><span class="bcpo-cart-item-price" data-key="{{line_item.key}}">{{ line_item.final_price | money }}</span></span>'><span class="bcpo-cart-item-price" data-key="{{line_item.key}}"><span class="bcpo-cart-item-price" data-key="{{line_item.key}}">{{ line_item.final_price | money }}</span></span></span>
                                      {%- endif -%}

                                    {%- elsif line_item.variant.compare_at_price > line_item.variant.price -%}
                                      <span class="line-item__price line-item__price--compare">{{- line_item.variant.compare_at_price | money -}}</span>

                                      {%- if line_item.final_price == 0 -%}
                                        <span class="line-item__price line-item__price--highlight">{{- 'cart.general.free' | t -}}</span>
                                      {%- else -%}
                                        <span class="line-item__price line-item__price--highlight" data-price='<span class="bcpo-cart-item-price" data-key="{{line_item.key}}"><span class="bcpo-cart-item-price" data-key="{{line_item.key}}">{{ line_item.final_price | money }}</span></span>'><span class="bcpo-cart-item-price" data-key="{{line_item.key}}"><span class="bcpo-cart-item-price" data-key="{{line_item.key}}">{{ line_item.final_price | money }}</span></span></span>
                                      {%- endif -%}

                                    {%- else -%}
                                      {%- if line_item.final_price == 0 -%}
                                        <span class="line-item__price">{{ 'cart.general.free' | t }}</span>
                                      {%- else -%}
                                        <span class="line-item__price" data-price='<span class="bcpo-cart-item-price" data-key="{{line_item.key}}"><span class="bcpo-cart-item-price" data-key="{{line_item.key}}">{{ line_item.final_price | money }}</span></span>'><span class="bcpo-cart-item-price" data-key="{{line_item.key}}"><span class="bcpo-cart-item-price" data-key="{{line_item.key}}">{{ line_item.final_price | money }}</span></span></span>
                                      {%- endif -%}

                                    {%- endif -%}
                                  </div>

                                  {%- if line_item.unit_price_measurement -%}
                                    <div class="line-item__price-info">
                                      <div class="unit-price-measurement">
                                        <span class="unit-price-measurement__price">{{ line_item.unit_price | money_without_trailing_zeros }}</span>
                                        <span class="unit-price-measurement__separator">/ </span>

                                        {%- if line_item.unit_price_measurement.reference_value != 1 -%}
                                          <span class="unit-price-measurement__reference-value">{{ line_item.unit_price_measurement.reference_value }}</span>
                                        {%- endif -%}

                                        <span class="unit-price-measurement__reference-unit">{{ line_item.unit_price_measurement.reference_unit }}</span>
                                      </div>
                                    </div>
                                  {%- endif -%}

                                  {%- if line_item.line_level_discount_allocations != blank -%}
                                    <ul class="line-item__discount-list" role="list">
                                      {%- for discount_allocation in line_item.line_level_discount_allocations -%}
                                        <li class="line-item__discount">
                                          {%- render 'icon', icon: 'sale' -%}{{ discount_allocation.discount_application.title }} (-{{ discount_allocation.amount | money }})
                                        </li>
                                      {%- endfor -%}
                                    </ul>
                                  {%- endif -%}
                                </div>

                                <span class="custom-price-cart custom-hidden-tab-up">
                                  <span class="line-item--line-price" data-line-price='<span class="bcpo-cart-item-line-price" data-key="{{line_item.key}}"><span class="bcpo-cart-item-line-price" data-key="{{line_item.key}}">{{ line_item.final_line_price | money }}</span></span>'><span class="bcpo-cart-item-line-price" data-key="{{line_item.key}}"><span class="bcpo-cart-item-line-price" data-key="{{line_item.key}}">{{ line_item.final_line_price | money }}</span></span></span>
                                </span>
                          
                              </div>
                            </td>

                            <td class="line-item__quantity table__cell--center hidden-phone">
                              {%- comment -%}If the product has the tag "__gift", we remove the price{%- endcomment -%}

                              {%- unless line_item.product.tags contains '__gift' -%}
                                <div class="quantity-selector">
                                  {%- assign allow_to_add_more = true -%}

                                  {%- if line_item.variant.inventory_management and line_item.variant.inventory_policy == 'deny' and line_item.quantity == line_item.variant.inventory_quantity -%}
                                    {%- assign allow_to_add_more = false -%}
                                  {%- endif -%}

                                  <button type="button" class="quantity-selector__button" data-action="decrease-quantity" data-href="{{ routes.cart_change_url }}?quantity={{ line_item.quantity | minus: 1 }}&line={{ forloop.index }}" data-quantity="{{ line_item.quantity | minus: 1 }}" data-line="{{ forloop.index }}" aria-label="{{ 'cart.items.decrease_quantity' | t }}" title="{{ 'cart.items.decrease_quantity' | t }}">{% render 'icon', icon: 'minus' %}</button>
                                  <input aria-label="{{ 'product.form.quantity' | t }}" class="quantity-selector__value" inputmode="numeric" data-current-value="{{ line_item.quantity }}" data-line="{{ forloop.index }}" value="{{ line_item.quantity }}" size="{{ line_item.quantity | append: '' | size | at_least: 2 }}">
                                  <button type="button" class="quantity-selector__button" data-action="increase-quantity" data-href="{{ routes.cart_change_url }}?quantity={{ line_item.quantity | plus: 1 }}&line={{ forloop.index }}" data-quantity="{{ line_item.quantity | plus: 1 }}" data-line="{{ forloop.index }}" {% if allow_to_add_more %}aria-label="{{ 'cart.items.increase_quantity' | t }}" title="{{ 'cart.items.increase_quantity' | t }}"{% else %}disabled="disabled" aria-label="{{ 'cart.items.no_more_stock' | t }}" data-tooltip="{{ 'cart.items.no_more_stock' | t }}" data-tooltip-position="bottom-left"{% endif %}>{% render 'icon', icon: 'plus' %}</button>
                                </div>
                              {%- else -%}
                                <span>{{ line_item.quantity }}</span>
                              {%- endunless -%}

                              {% comment %}<a href="{{ routes.cart_change_url }}?quantity=0&line={{ forloop.index }}" data-action="decrease-quantity" data-quantity="0" data-line="{{ forloop.index }}" class="line-item__quantity-remove link">
                                <svg viewBox="-40 0 427 427.00131" xmlns="http://www.w3.org/2000/svg">
                                  <path d="m232.398438 154.703125c-5.523438 0-10 4.476563-10 10v189c0 5.519531 4.476562 10 10 10 5.523437 0 10-4.480469 10-10v-189c0-5.523437-4.476563-10-10-10zm0 0" fill="#949495"/>
                                  <path d="m114.398438 154.703125c-5.523438 0-10 4.476563-10 10v189c0 5.519531 4.476562 10 10 10 5.523437 0 10-4.480469 10-10v-189c0-5.523437-4.476563-10-10-10zm0 0" fill="#949495"/>
                                  <path d="m28.398438 127.121094v246.378906c0 14.5625 5.339843 28.238281 14.667968 38.050781 9.285156 9.839844 22.207032 15.425781 35.730469 15.449219h189.203125c13.527344-.023438 26.449219-5.609375 35.730469-15.449219 9.328125-9.8125 14.667969-23.488281 14.667969-38.050781v-246.378906c18.542968-4.921875 30.558593-22.835938 28.078124-41.863282-2.484374-19.023437-18.691406-33.253906-37.878906-33.257812h-51.199218v-12.5c.058593-10.511719-4.097657-20.605469-11.539063-28.03125-7.441406-7.421875-17.550781-11.5546875-28.0625-11.46875h-88.796875c-10.511719-.0859375-20.621094 4.046875-28.0625 11.46875-7.441406 7.425781-11.597656 17.519531-11.539062 28.03125v12.5h-51.199219c-19.1875.003906-35.394531 14.234375-37.878907 33.257812-2.480468 19.027344 9.535157 36.941407 28.078126 41.863282zm239.601562 279.878906h-189.203125c-17.097656 0-30.398437-14.6875-30.398437-33.5v-245.5h250v245.5c0 18.8125-13.300782 33.5-30.398438 33.5zm-158.601562-367.5c-.066407-5.207031 1.980468-10.21875 5.675781-13.894531 3.691406-3.675781 8.714843-5.695313 13.925781-5.605469h88.796875c5.210937-.089844 10.234375 1.929688 13.925781 5.605469 3.695313 3.671875 5.742188 8.6875 5.675782 13.894531v12.5h-128zm-71.199219 32.5h270.398437c9.941406 0 18 8.058594 18 18s-8.058594 18-18 18h-270.398437c-9.941407 0-18-8.058594-18-18s8.058593-18 18-18zm0 0" fill="#949495"/>
                                  <path d="m173.398438 154.703125c-5.523438 0-10 4.476563-10 10v189c0 5.519531 4.476562 10 10 10 5.523437 0 10-4.480469 10-10v-189c0-5.523437-4.476563-10-10-10zm0 0" fill="#949495"/>
                                </svg>
                              </a>{% endcomment %}
                              <a href="{{ routes.cart_change_url }}?quantity=0&line={{ forloop.index }}" data-action="decrease-quantity" data-quantity="0" data-line="{{ forloop.index }}" class="line-item__quantity-remove link cart_custom_remove">
                                Remove
                              </a>
                            </td>

                            <td class="line-item__line-price table__cell--right custom-hidden-phone">
                              {%- if line_item.final_line_price == 0 -%}
                                {{- 'cart.general.free' | t -}}
                              {%- else -%}
                                <span class="custom-price-cart">
                                <span class="line-item--line-price" data-line-price='<span class="bcpo-cart-item-line-price" data-key="{{line_item.key}}"><span class="bcpo-cart-item-line-price" data-key="{{line_item.key}}">{{ line_item.final_line_price | money }}</span></span>'><span class="bcpo-cart-item-line-price" data-key="{{line_item.key}}"><span class="bcpo-cart-item-line-price" data-key="{{line_item.key}}">{{ line_item.final_line_price | money }}</span></span></span>
                                </span>
                                {%- endif -%}
                            </td>
                          </tr>
                        {%- endfor -%}
                      </tbody>
                    </table>
                  </div>
                </div>

                {%- comment -%}
                --------------------------------------------------------------------------------------
                GIFT WRAP
                --------------------------------------------------------------------------------------
                {%- endcomment -%}

                {%- assign gift_wrap_product = section.settings.gift_wrap_product -%}

                {%- unless gift_wrap_product == blank or gift_wrap_product.available == false -%}
                  {%- comment -%}We also have to do another check to make sure the gift wrap product is not already in the cart{%- endcomment -%}

                  {%- assign gift_wrap_in_cart = false -%}

                  {%- for line_item in cart.items -%}
                    {%- if line_item.product_id == gift_wrap_product.id -%}
                      {%- assign gift_wrap_in_cart = true -%}
                      {%- break -%}
                    {%- endif -%}
                  {%- endfor -%}

                  
                  

                  {%- unless gift_wrap_in_cart -%}
                    <div class="card">
                      <div class="gift-wrap">
                        <div class="gift-wrap__left">
                          <span class="gift-wrap__icon">{% render 'icon', icon: 'bi-gift-wrap' %}</span>

                          <p class="gift-wrap__text">
                            <span class="text--strong">{{ section.settings.gift_wrap_text | escape }}</span>

                            {%- if gift_wrap_product.price == 0 -%}
                              <span>{{ 'cart.general.free' | t }}</span>
                            {%- else -%}
                              {%- capture gift_wrap_product_price -%}<span>{{ gift_wrap_product.price | money }}</span>{%- endcapture -%}
                              <span>{{ 'cart.gift_wrap.price_html' | t: price: gift_wrap_product_price }}</span>
                            {%- endif -%}
                          </p>
                        </div>

                        {%- form 'product', gift_wrap_product, class: 'gift-wrap__form' -%}
                          <input type="hidden" name="quantity" value="1">
                          <input type="hidden" name="id" data-sku="{{ gift_wrap_product.first_available_variant.sku }}" value="{{ gift_wrap_product.first_available_variant.id }}">
                          

                          <button type="submit" class="button button--secondary" data-action="add-to-cart">{{ section.settings.gift_wrap_button | escape }}</button>
                        {%- endform -%}
                      </div>
                    </div>
                  {%- endunless -%}
                {%- endunless -%}

                {%- comment -%}
                --------------------------------------------------------------------------------------
                SHIPPING ESTIMATOR
                --------------------------------------------------------------------------------------
                {%- endcomment -%}

                {%- assign items_requiring_shipping = cart.items | where: 'requires_shipping' -%}

                {%- if section.settings.show_shipping_estimator and items_requiring_shipping.size > 0 -%}
                  <div class="card">
                    <div class="estimate-shipping">
                      <button type="button" class="estimate-shipping__toggle" data-action="toggle-collapsible" data-collapsible-force-overflow aria-expanded="false" aria-controls="shipping-estimator">
                        <span class="estimate-shipping__icon">{% render 'icon', icon: 'bi-fast-delivery' %}</span>
                        <span class="estimate-shipping__text">{{ 'cart.shipping_estimator.title' | t }}</span>
                        <span class="estimate-shipping__arrow">{% render 'icon', icon: 'arrow-bottom' %}</span>
                      </button>

                      <div id="shipping-estimator" class="estimate-shipping__collapsible collapsible">
                        <div class="shipping-estimator form" role="form">
                          <div class="form__input-row">
                            <div class="form__input-wrapper">
                              <label for="shipping-estimator-country" class="form__label form__label--light">{{ 'cart.shipping_estimator.country' | t }}</label>

                              <div class="select-wrapper select-wrapper--primary">
                                {%- render 'icon', icon: 'arrow-bottom' -%}

                                <select name="country" id="shipping-estimator-country" data-default="{{ customer.default_address.country | default: section.settings.shipping_estimator_default_country }}" required>
                                  {{- country_option_tags -}}
                                </select>
                              </div>
                            </div>

                            <div class="form__input-wrapper" style="display: none">
                              <label for="shipping-estimator-province" class="form__label form__label--light">{{ 'cart.shipping_estimator.province' | t }}</label>

                              <div class="select-wrapper select-wrapper--primary">
                                {%- render 'icon', icon: 'arrow-bottom' -%}

                                <select name="province" id="shipping-estimator-province" data-default="{{ customer.default_address.province }}"></select>
                              </div>
                            </div>

                            <div class="form__input-wrapper" style="max-width: 155px">
                              <label for="shipping-estimator-zip" class="form__label form__label--light">{{ 'cart.shipping_estimator.zip_code' | t }}</label>
                              <input type="text" name="zip" id="shipping-estimator-zip" class="form__field form__field--text" value="{{ customer.default.address.zip }}" required>
                            </div>

                            <div class="form__input-wrapper hidden-phone">
                              <button type="button" class="form__submit button button--secondary" data-action="estimate-shipping">{{ 'cart.shipping_estimator.estimate' | t }}</button>
                            </div>
                          </div>

                          <button type="button" class="form__submit button button--secondary hidden-tablet-and-up" data-action="estimate-shipping">{{ 'cart.shipping_estimator.estimate' | t }}</button>

                          <div class="shipping-estimator__results" style="display: none;"></div>
                        </div>
                      </div>
                    </div>
                  </div>
                {%- endif -%}

                {%- comment -%}
                --------------------------------------------------------------------------------------
                RECAP
                --------------------------------------------------------------------------------------
                {%- endcomment -%}

                <div class="cart-recap">
                  <div id="cube" class="cart-recap__scroller">
                    <div class="cart_create cart-inner cube-face-front is-active">
                      <form class="cart-recap-form" method="post" action="{{ routes.cart_url }}" novalidate="novalidate" data-item-count="{{ cart.item_count }}">
                        <div class="cart-recap__scroller">
                          <div class="card">
                            <div class="card__section">
                              {%- if cart.cart_level_discount_applications != blank -%}
                                {%- for discount_application in cart.cart_level_discount_applications -%}
                                  <div class="cart-recap__price-line cart-recap__price-line--highlight text--pull">
                                    <span class="cart-recap__price-line-label">{{ discount_application.title }}</span>
                                    <span class="cart-recap__price-line-price">-{{ discount_application.total_allocated_amount | money }}</span>
                                  </div>
                                {%- endfor -%}
                              {%- endif -%}

                              <div class="custom_info_title"> Order Summary </div>

                              {%- comment -%}
                              To calculate the total discount, we take into account the Shopify Script (for Plus merchants), but we also add the compare at price as
                              well as potential automatic discounts at cart level
                              {%- endcomment -%}

                              {%- assign total_discount = 0 -%}

                              {%- for line_item in cart.items -%}
                                {%- if line_item.final_line_price < line_item.original_line_price -%}
                                  {%- assign total_discount = total_discount | plus: line_item.total_discount -%}
                                {%- elsif line_item.variant.compare_at_price > line_item.variant.price -%}
                                  {%- assign line_discount = line_item.variant.compare_at_price | minus: line_item.variant.price | times: line_item.quantity -%}
                                  {%- assign total_discount = total_discount | plus: line_discount -%}
                                {%- endif -%}
                              {%- endfor -%}

                              {%- for discount_application in cart.cart_level_discount_applications -%}
                                {%- assign total_discount = total_discount | plus: discount_application.total_allocated_amount -%}
                              {%- endfor -%}

                              {% comment %}
                              {%- if total_discount > 0 -%}
                                {%- capture amount_saved -%}<span>{{ total_discount | money }}</span>{%- endcapture -%}
                                <span class="cart-recap__amount-saved">{{ 'cart.general.amount_saved_html' | t: amount_saved: amount_saved }}</span>
                              {%- endif -%}
                              {% endcomment %}

                              {%- if total_discount > 0 -%}
                                <div class="custom-cart-amount-saved">
                                  {%- capture amount_saved -%}
                                    {% assign modified_currency_code = "!" | append: cart.currency.iso_code %}
                                    <span class="cart-amount-saved">{{ total_discount | money_with_currency }}</span>
                                  {%- endcapture -%}
                                  <span class="cart-recap__amount-saved">Your Total Savings</span>
                                  {{ amount_saved }}
                                </div>
                              {%- endif -%}

                              

                              <div class="cart-recap__price-line text--pull">
                                <span class="cart-recap__price-line-label">Cart Total</span>
                                <span class="cart-recap__price-line-price cart-sub-total-price" data-subtotal='<span class="bcpo-cart-original-total"><span class="bcpo-cart-original-total">{{ cart.items_subtotal_price | money }}</span></span>'><span class="bcpo-cart-original-total"><span class="bcpo-cart-original-total">{{ cart.total_price | money_with_currency }}</span></span></span>
                              </div>

                              {%- if section.settings.enable_order_notes -%}
                                <div class="cart-recap__note">
                                  <button type="button" class="cart-recap__note-button" data-action="toggle-collapsible" data-collapsible-force-overflow aria-controls="order-note" aria-expanded="false">
                                    {{- 'cart.general.note_title' | t -}}
                                    <span>
                                      <span class="cart-recap__note-edit {% if cart.note != blank %}is-visible{% endif %}">{{ 'cart.general.edit_note' | t }}</span>
                                      {%- render 'icon', icon: 'arrow-bottom' -%}
                                    </span>
                                  </button>

                                  <div id="order-note" class="collapsible" aria-hidden="true">
                                    <div class="cart-recap__note-inner">
                                      <textarea name="note" class="form__field form__field--textarea" rows="3">{{ cart.note }}</textarea>
                                      <button type="button" class="form__submit form__submit--tight button button--ternary" data-action="save-note">{{ 'cart.general.save_note' | t }}</button>
                                    </div>
                                  </div>
                                </div>
                              {%- endif -%}

                              <div class="cart-recap__notices rte">
                                <p>
                                  {%- if cart.taxes_included and shop.shipping_policy.body != blank -%}
                                    {{ 'cart.general.taxes_included_and_shipping_policy_html' | t: link: shop.shipping_policy.url }}
                                  {%- elsif cart.taxes_included -%}
                                    {{ 'cart.general.taxes_included_but_shipping_at_checkout' | t }}
                                  {%- elsif shop.shipping_policy.body != blank -%}
                                    {{ 'cart.general.taxes_and_shipping_policy_at_checkout_html' | t: link: shop.shipping_policy.url }}
                                  {%- else -%}
                                    {{ 'cart.general.taxes_and_shipping_at_checkout' | t }}
                                  {%- endif -%}
                                </p>
                              </div>

                              <input type="hidden" name="attributes[collection_products_per_page]" value="">
                              <input type="hidden" name="attributes[collection_layout]" value="">

                              <div class="mmnal">
                                {% if customer %}
                                  <button type="submit" name="checkout" class="cart-page-logged-checkout-btn cart-recap__checkout button button--primary button--full button--large cart_custom_checkt_btn">Proceed to checkout</button>
                                {% else %}
                                  <a id="cart-page-unlogged-checkout-link" href="{{ pages['guest-checkout'].url }}" name="checkout" class="cart-recap__checkout button button--primary button--full button--large cart_custom_checkt_btn">Proceed to checkout</a>
                                  <button id="cart-page-logged-checkout-btn" style="display: none;" type="submit" name="checkout" class="cart-recap__checkout button button--primary button--full button--large">{{ 'cart.general.checkout' | t }}</button>
                                {% endif %}
                              </div>

                            {% comment %}  <a id="cart-page-request-a-quote-link" {% if customer %}href="{{ pages['new-addresses'].url }}"{% else %}href="{{ pages['request-quote-register'].url }}"{% endif %} class="button button--small button--ternary usca custom_request_flip_btn" data-user="{% if customer %}true{% else %}false{% endif %}" data-customer-id="{{ customer.id }}" data-shopify-logged-url="{{ pages['new-addresses'].url }}">Request A Quote</a>  {% endcomment %}
                            </div>
                          </div>

                          {%- if section.settings.show_payment_icons -%}
                            <div class="cart-recap__secure-payment">
                              <p class="cart-recap__secure-payment-title">{% render 'icon', icon: 'lock-2' %} {{ 'cart.general.secure_payments' | t }}</p>

                              <div class="cart-recap__secure-payment-list payment-list payment-list--centered">
                                {% assign enabled_payment_types = 'american_express,visa,master,discover,apple_pay,paypal,amazon,google_pay,shopify_pay' | remove: ' ' | split: ',' %}
                                {% for type in enabled_payment_types %}
                                  {{ type | payment_type_svg_tag: class: 'payment-list__item' }}
                                {% endfor %}
                              </div>
                            </div>
                          {%- endif -%}
                        </div>
                      </form>
                    </div>
                  </div>
                </div>

              </div>
            </div>

            {%- comment -%}
            --------------------------------------------------------------------------------------
            UPSELL
            --------------------------------------------------------------------------------------
            {%- endcomment -%}

            {%- assign upsell_collection = section.settings.upsell_collection -%}

            {%- if section.blocks.size > 0 or upsell_collection != blank -%}
              <div class="container">
                {%- if section.blocks.size > 0 -%}
                  <div class="section">
                    <header class="section__header">
                      <h2 class="section__title heading h3">{{ section.settings.trust_heading | escape }}</h2>
                    </header>

                    <div class="text-with-icons text-with-icons--boxed">
                      {%- for block in section.blocks -%}
                        <div class="text-with-icons__item" {{ block.shopify_attributes }}>
                          <div class="text-with-icons__icon-wrapper">
                            {%- if block.settings.custom_icon != blank -%}
                              <img loading="lazy" src="{{ block.settings.custom_icon | img_url: '60x' }}" alt="{{ block.settings.custom_icon.alt | escape }}">
                            {%- else -%}
                              {%- render 'icon', icon: block.settings.icon, stroke_width: 1.5 -%}
                            {%- endif -%}
                          </div>

                          {%- if block.settings.title != blank or block.settings.content != blank -%}
                            <div class="text-with-icons__content-wrapper">
                              {%- if block.settings.title != blank -%}
                                <p class="text-with-icons__title text--strong">{{ block.settings.title | escape }}</p>
                              {%- endif -%}

                              {%- if block.settings.content != blank -%}
                                <div class="text-with-icons__content rte">
                                  {{ block.settings.content  }}
                                </div>
                              {%- endif -%}
                            </div>
                          {%- endif -%}
                        </div>
                      {%- endfor -%}
                    </div>
                  </div>
                {%- endif -%}

                {%- if upsell_collection != empty -%}
                  {%- comment -%}We iterate through all the products, by making sure to remove those that are already in the cart{%- endcomment -%}

                  {%- capture upsell_products -%}
                    {%- assign upsell_products_count = 0 -%}

                    {%- for product in upsell_collection.products -%}
                      {%- unless product.available -%}
                        {%- continue -%}
                      {%- endunless -%}

                      {%- assign include_product = true -%}

                      {%- for line_item in cart.items -%}
                        {%- if line_item.product_id == product.id -%}
                          {%- assign include_product = false -%}
                          {%- break -%}
                        {%- endif -%}
                      {%- endfor -%}

                      

                      {%- if include_product -%}
                        {%- render 'product-item', product: product, show_add_to_cart: true, grid_classes: '1/3--lap 1/3--desk 1/4--wide' -%}

                        {%- comment -%}Check how much products we have shown and limit{%- endcomment -%}
                        {%- assign upsell_products_count = upsell_products_count | plus: 1 -%}

                        {%- if upsell_products_count >= section.settings.upsell_products_count -%}
                          {%- break -%}
                        {%- endif -%}
                      {%- endif -%}
                    {%- endfor -%}
                  {%- endcapture -%}

                  {%- if upsell_products != blank -%}
                    {%- capture section_settings -%}
                    {
                      "stackable": false,
                      "layout": "vertical"
                    }
                    {%- endcapture -%}

                    <div class="section" data-section-id="{{ section.id }}-upsell" data-section-type="featured-collection" data-section-settings='{{ section_settings }}'>
                      <header class="section__header">
                        <h2 class="section__title heading h3">{{ section.settings.upsell_heading | escape }}</h2>
                      </header>

                      <div class="scroller">
                        <div class="scroller__inner">
                          <div class="product-list product-list--vertical product-list--scrollable">
                            {{ upsell_products }}
                          </div>
                        </div>
                      </div>
                    </div>

                    {%- comment -%}
                    --------------------------------------------------------------------------------------
                    QUICK VIEW CONTAINER
                    --------------------------------------------------------------------------------------
                    {%- endcomment -%}

                    <div id="modal-quick-view-{{ section.id }}" class="modal" aria-hidden="true">
                      <div class="modal__dialog modal__dialog--stretch" role="dialog">
                        <div class="modal__loader">
                          {%- render 'icon', icon: 'search-loader' -%}
                        </div>

                        <div class="modal__inner"></div>
                      </div>
                    </div>
                  {%- endif -%}
                {%- endif -%}
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    {%- endif -%}
  </div>
</section>
<style>
  a.button.button--small.button--ternary {
    width: 100%;
    margin-top: 15px;
    padding: 5px 3px;
  }
</style>

{% schema %}
{
  "name": "Cart",
  "max_blocks": 3,
  "settings": [
    {
      "type": "paragraph",
      "content": "Those settings are only applicable when the cart contains at least one product."
    },
    {
      "type": "checkbox",
      "id": "enable_order_notes",
      "label": "Enable order notes",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_payment_icons",
      "label": "Show payment icons",
      "default": true
    },
    {
      "type": "header",
      "content": "Gift wrap"
    },
    {
      "type": "paragraph",
      "content": "Gift wrap needs to be set up as a product. [Read more](https://support.maestrooo.com/article/190-cart-set-up-a-gift-wrap-product)"
    },
    {
      "type": "product",
      "id": "gift_wrap_product",
      "label": "Product"
    },
    {
      "type": "text",
      "id": "gift_wrap_text",
      "label": "Text",
      "default": "Do you want a gift wrap?"
    },
    {
      "type": "text",
      "id": "gift_wrap_button",
      "label": "Button",
      "default": "Add a gift wrap"
    },
    {
      "type": "header",
      "content": "Shipping estimator"
    },
    {
      "type": "checkbox",
      "id": "show_shipping_estimator",
      "label": "Show shipping rates calculator",
      "default": true
    },
    {
      "type": "text",
      "id": "shipping_estimator_default_country",
      "label": "Default country",
      "info": "If the customer is logged in, the country of their shipping address will be used.",
      "default": "United States"
    },
    {
      "type": "text",
      "id": "trust_heading",
      "label": "Heading",
      "default": "Our guarantees"
    },
    {
      "type": "header",
      "content": "Upsell"
    },
    {
      "type": "paragraph",
      "content": "Show additional products to encourage customers to buy more."
    },
    {
      "type": "text",
      "id": "upsell_heading",
      "label": "Heading",
      "default": "Complete your cart"
    },
    {
      "type": "collection",
      "id": "upsell_collection",
      "label": "Collection",
      "info": "Products already in cart or sold out will be hidden."
    },
    {
      "type": "range",
      "id": "upsell_products_count",
      "label": "Products to show",
      "min": 4,
      "max": 12,
      "step": 4,
      "default": 4
    }
  ],
  "blocks": [
    {
      "name": "Trust text",
      "type": "trust",
      "settings": [
        {
          "type": "select",
          "id": "icon",
          "label": "Icon",
          "options": [
            {
              "value": "bi-add-to-cart",
              "label": "Add to cart",
              "group": "Shop"
            },
            {
              "value": "bi-gift-wrap",
              "label": "Gift wrap",
              "group": "Shop"
            },
            {
              "value": "bi-gift-box",
              "label": "Gift box",
              "group": "Shop"
            },
            {
              "value": "bi-heart",
              "label": "Heart",
              "group": "Shop"
            },
            {
              "value": "bi-ecology",
              "label": "Ecology",
              "group": "Shop"
            },
            {
              "value": "bi-plant",
              "label": "Plant",
              "group": "Shop"
            },
            {
              "value": "bi-shop",
              "label": "Shop",
              "group": "Shop"
            },
            {
              "value": "bi-shop-pin",
              "label": "Shop with pin",
              "group": "Shop"
            },
            {
              "value": "bi-alert",
              "label": "Alert",
              "group": "Communication"
            },
            {
              "value": "bi-chat",
              "label": "Chat",
              "group": "Communication"
            },
            {
              "value": "bi-comment",
              "label": "Comment",
              "group": "Communication"
            },
            {
              "value": "bi-customer-support",
              "label": "Customer support",
              "group": "Communication"
            },
            {
              "value": "bi-email",
              "label": "Email",
              "group": "Communication"
            },
            {
              "value": "bi-network",
              "label": "Network",
              "group": "Communication"
            },
            {
              "value": "bi-newsletter",
              "label": "Newsletter",
              "group": "Communication"
            },
            {
              "value": "bi-love",
              "label": "Love",
              "group": "Communication"
            },
            {
              "value": "bi-phone",
              "label": "Phone",
              "group": "Communication"
            },
            {
              "value": "bi-share",
              "label": "Share",
              "group": "Communication"
            },
            {
              "value": "bi-delivery",
              "label": "Delivery",
              "group": "Delivery"
            },
            {
              "value": "bi-fast-delivery",
              "label": "Fast delivery",
              "group": "Delivery"
            },
            {
              "value": "bi-returns",
              "label": "Returns",
              "group": "Delivery"
            },
            {
              "value": "bi-time",
              "label": "Time",
              "group": "Delivery"
            },
            {
              "value": "bi-secure-payment",
              "label": "Secure payment",
              "group": "Security"
            },
            {
              "value": "bi-mobile-payment",
              "label": "Mobile payment",
              "group": "Security"
            },
            {
              "value": "bi-credit-card",
              "label": "Credit card",
              "group": "Security"
            },
            {
              "value": "bi-shield",
              "label": "Shield",
              "group": "Security"
            }
          ],
          "default": "bi-customer-support"
        },
        {
          "type": "image_picker",
          "id": "custom_icon",
          "label": "Custom icon",
          "info": "60 x 60px .png with transparency recommended"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Heading",
          "default": "Your title"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Content",
          "default": "<p>Short content about your store</p>"
        }
      ]
    }
  ]
}
{% endschema %}
<!-- bcpo done -->